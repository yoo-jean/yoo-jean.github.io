---
title: 동시성 정리 노트 ③ 멀티스레딩의 현실적인 문제 
date: 2026-01-14 11:00:00 +0900
categories: [CS, Concurrency]
tags: [multithreading, concurrency, performance]
---

멀티스레딩은 성능 향상을 위한 강력한 도구이지만  
현실에서는 오히려 복잡성과 위험을 동반한다.  
멀티스레딩이 실제로 어떤 문제를 만들고, 왜 신중하게 사용해야 하는지를 정리해본다.

---

## 3.1 멀티스레딩이란 무엇인가

### 멀티스레딩의 정의

멀티스레딩이란 하나의 프로세스 안에서 여러 개의 스레드가  
동시에 실행되는 구조를 의미한다.  
각 스레드는 독립적인 실행 흐름을 가지지만,  
메모리(Heap, Method Area 등)는 공유한다.

즉,
- **실행은 분리되어 있지만**
- **데이터는 공유된다**

이 구조가 모든 문제의 출발점이다.

---

### 성능이 좋아지는 경우

멀티스레딩이 효과적인 대표적인 경우는 다음과 같다.

- **I/O Bound 작업**
  - 네트워크 통신
  - 파일 읽기/쓰기
  - DB 조회

- **대기 시간이 긴 작업**
  - 하나의 스레드가 대기 중일 때
  - 다른 스레드가 CPU를 활용 가능

- **독립적인 작업 단위가 명확한 경우**
  - 서로 공유 데이터가 거의 없는 작업

이런 경우에는 CPU 사용률이 높아지고,  
전체 처리 시간이 단축된다.

---

### 오히려 성능이 나빠지는 경우

멀티스레딩은 항상 성능을 올려주지 않는다.  
오히려 다음 상황에서는 성능이 악화된다.

- **CPU Bound 작업에서 과도한 스레드 생성**
  - Context Switching 비용 증가
  - 캐시 미스 증가

- **공유 자원에 대한 잦은 동기화**
  - Lock 경쟁
  - Thread Block / Wake-up 비용

- **코어 수보다 많은 스레드**
  - 실행보다 스케줄링에 더 많은 비용 발생

결론적으로,
> 멀티스레딩은 *공짜 성능 향상 도구가 아니다.*

---

## 3.2 동시성 문제의 본질

멀티스레딩의 핵심 문제는 **동시성(Concurrency)** 이다.  
동시성 문제는 대부분 아래 네 가지 개념으로 정리된다.

---

### Race Condition

두 개 이상의 스레드가  
공유 자원에 동시에 접근하고,  
실행 순서에 따라 결과가 달라지는 상황을 말한다.

- 실행 결과가 비결정적
- 재현이 어렵고 디버깅이 힘듦

Race Condition은
> “코드가 잘못된 게 아니라, **타이밍이 문제**” 인 상황이다.

---

### Visibility 문제

한 스레드에서 변경한 값이  
다른 스레드에서 즉시 보이지 않는 현상이다.

원인:
- CPU 캐시
- 컴파일러 최적화
- 메인 메모리와의 불일치

이 문제 때문에
- 값은 변경됐지만
- 다른 스레드는 이전 값을 보는
  상황이 발생한다.

---

### Atomicity

하나의 연산이  
**쪼개지지 않고 한 번에 실행되는 성질**을 의미한다.

예:
- `count++` 는 원자적이지 않다
  - 읽기 → 증가 → 쓰기

여러 단계로 구성된 연산은  
스레드 간 간섭이 발생할 수 있다.

---

### Happens-Before 관계

Happens-Before는  
**작업 간의 실행 순서와 메모리 가시성을 보장하는 규칙**이다.

- A가 B보다 Happens-Before라면
  - A의 결과는 반드시 B에서 관측된다

예시:
- `synchronized` 블록
- `volatile` 변수
- 스레드 시작과 종료 규칙

Happens-Before는  
동시성 문제를 이해하는 **이론적 기반**이다.

---

## 정리

- 멀티스레딩은 성능을 올릴 수도, 망칠 수도 있다
- 문제의 핵심은 **공유 상태**
- Race Condition, Visibility, Atomicity는 반드시 함께 고려해야 한다
- Happens-Before를 이해해야 안전한 동시성 설계가 가능하다

멀티스레딩은
> "빠르게 만드는 기술" 이 아니라  
> "안전하게 다루기 어려운 기술" 이다.
